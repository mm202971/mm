<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="xiang.css">
	</head>
	
	
	
	
	
	<body>
		<div class="a a7">
		<div id="header">
			<p>您好，欢迎访问苏州金土地信息科技有限公司《聚宝林》<a href="../denglu/denglu.html">登陆</a>|<a href="../zhuce/zhuce.html">注册</a> </p>
			<div class="b">
				<a href="">我的服务</a>
				<i></i>|
				<a href="">最近浏览</a>
				<i></i>|
				<a href="">我是商家</a>
				<i></i>
				<a href="">商家入驻</a>
			</div>
		</div>
		</div>
		<div id="a">
			<div id="nav">
				<div class="xia">
					<ul>
						<li>在线预约</li>
						<li>送货上门</li>
						<li>打的取货</li>
					</ul>
					
				</div>
				<div class="logo">
			  		<img src="../images/logo.png">
					<div class="v">
						<h3>苏州</h3>
						<a href="">更换城市</a>
					</div>
				</div>
			<div class="b">
				<div class="c">
					<a href="">全部</a>
					<i></i>
				</div>
					<input type="text">
				<div class="d">
					<img src="../images/sousuo.png" >
				</div>
			</div>
			<div class="right"> 
			     <a href="" class="a"></a>
			   	 <a href="" class="x"></a> 
			   	 <a href="" class="c"></a>
			   
			</div>
			</div>
		</div>
		<div id="a">
			<div id="j">
				<p>上门按摩>>休闲按摩>>姑苏区>>江星商业广场>>威兰之恋单人按摩高档套餐</p>
			</div>
		</div>
		<div id="a">
			<div id="y">
				<div class="left">
					<h3>威兰之恋单人按摩高档套餐 13店通用</h3>
					<p>仅售599元，价值1199元世尊单人套餐！</p>
					<div class="s_box">
					<div class="ri">
						
					</div>
					<span></span>
					<p></p>
					</div>
					<ul>
						<li></li>
						<li></li>
						<li></li>
						<li></li>
					</ul>
				</div>
				<div class="right"><div class="b_box"></div>
					
						
					
					<div class="qiang">
						<p>抢购价￥199 &nbsp 原价￥599  &nbsp 95折</p>
						<h3> 已售65 &nbsp 99* 人已评价    &nbsp 8.5分 </h3>
						<p>有效期到 &nbsp  &nbsp2022-05-26</p>
						<div class="btn">
							<p>数量</p>
							<div class="an">
								<i>5</i>
								<b>
									<a href=""><u>^</u></a>
									<a href=""><s>^</s></a>
								</b>
							</div>
						</div>
						<div class="e">
						     <a href="../gouwuche/che.html"><div class="p">进入购物车</div></a>
						     <a><div class="che">加入购物车</div></a>
						 </div>
						 <img src="./img/pl.png">
						</div>
					
					</div>
					<img src="">
				
				</div>
			</div>
		</div>
	
	</body>
	<script src="jquery.js"></script>
	<script src="ajax.js"></script>
	


<script>
	class GoodsList{
        constructor(){
            this.ri = document.querySelector(".ri");
            this.ct=document.querySelector(".b_box")
            this.url = "http://localhost/1905/anmo/shouye/anmo.json";
            this.init();
			this.id = this.getUrlParam("id")
			
        }
       
        
        init(){
            var that = this;
            ajaxPost(this.url,function(res){
            	// console.log(res)
				that.res = JSON.parse(res);
				// console.log(that.res)
                that.display()
            })
        }
		getUrlParam(name){
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i"); 
        
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
        display(){
        	
        	var str=""
       
        // 	this.id = localStorage.getItem("goods")
        // 	console.log(this.id)
        // 	this.id = JSON.parse(this.id)
        // console.log(this.res)
        // console.log(this.id)
        	// for(var j=0;j<this.goodsinumber.length;j++){
        	// 	console.log(this.goodsidnumber[j]);
			// }

				for(var i = 0;i<this.res.length;i++){
					
					
					
					if(this.res[i].id==this.id){
					
					str =`
						<a href="" index="${this.res[i].id}">
						<img src="${this.res[i].src}" class="re">
						</a>
						`   
					}
				}
				this.ri.innerHTML= str;
				this.ct.innerHTML=str;
			}
		
 }
  new GoodsList;

</script>
<script>
	
    class Fu{
        constructor(){
            this.cont = document.querySelector(".che");
   

            this.url = "http://localhost/1905/anmo/shouye/anmo.json";
            
            this.init();
            // 1.绑定事件
            this.addEvent();
        }
        addEvent(){
            var that = this;
            document.onclick = function(eve){
            	
                var e = eve || window.event;
                var t = e.target || e.srcElement;
                if(t.className == "che"){
                    // 2.获取当前的商品ID
                    console.log(t.className == "che");
                    that.id = t.parentNode .parentNode .parentNode .parentNode.firstElementChild.firstElementChild.getAttribute("index");
                    // 3.存localstorage
                    console.log(that.id);
                    that.setData();
                }
            }
        }
        setData(){
            // console.log(this.id);
            // 保存多个商品，数量，一条本地存储
            // 数组中放对象的形式处理数据
            // 每个对象是一个商品
            // 整个数组是一条本地存储
            // [{id:"adsa",num:1},{},{}]

            this.goods = localStorage.getItem("goods");

            if(this.goods){
                // 不是第一次
                this.goods = JSON.parse(this.goods)

                var onoff = true;
                // 之后存
                for(var i=0;i<this.goods.length;i++){
                    // 老的
                    if(this.goods[i].id == this.id){
                        this.goods[i].num++;
                        onoff = false;
                    }
                }
                // 新的
                if(onoff){
                    this.goods.push({
                        id:this.id,
                        num:1
                    })
                }
            }else{
                // 第一次存
                //     直接存
                this.goods = [{
                    id:this.id,
                    num:1
                }];
            }
            
            // 最后将数据设置回去
            localStorage.setItem("goods",JSON.stringify(this.goods))
        }
        init(){
            var that = this;
            ajaxPost(this.url,function(res){
                that.res = JSON.parse(res);
                
            })
        }
        
    }
    new Fu;

    </script>
    
</html>
